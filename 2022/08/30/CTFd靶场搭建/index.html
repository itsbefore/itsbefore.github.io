<!DOCTYPE html>
<html lang=zh>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="基于docker搭建支持动态靶机的靶场">
<meta property="og:type" content="article">
<meta property="og:title" content="CTFd动态靶机搭建">
<meta property="og:url" content="https://itsbefore.github.io/archives/2022/08/30/CTFd%E9%9D%B6%E5%9C%BA%E6%90%AD%E5%BB%BA/index.html">
<meta property="og:site_name" content="itsbefore">
<meta property="og:description" content="基于docker搭建支持动态靶机的靶场">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://itsbefore.github.io/images/ctfd.png">
<meta property="article:published_time" content="2022-08-30T05:10:33.000Z">
<meta property="article:modified_time" content="2023-12-24T05:51:49.983Z">
<meta property="article:author" content="itsbefore">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://itsbefore.github.io/images/ctfd.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>CTFd动态靶机搭建</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 6.1.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="目录"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="目录"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="顶部" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">首页</a></li><!--
     --><!--
       --><li><a href="/archives/">归档</a></li><!--
     --><!--
       --><li><a href="/categories/">分类</a></li><!--
     --><!--
       --><li><a href="/about/">关于</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="上一篇" href="/2022/09/04/2022%E7%BE%8A%E5%9F%8E%E6%9D%AFwp/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="下一篇" href="/2022/08/29/ctfshow%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="返回顶部" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="分享文章" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">上一篇</span>
      <span id="i-next" class="info" style="display:none;">下一篇</span>
      <span id="i-top" class="info" style="display:none;">返回顶部</span>
      <span id="i-share" class="info" style="display:none;">分享文章</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://itsbefore.github.io/archives/2022/08/30/CTFd%E9%9D%B6%E5%9C%BA%E6%90%AD%E5%BB%BA/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://itsbefore.github.io/archives/2022/08/30/CTFd%E9%9D%B6%E5%9C%BA%E6%90%AD%E5%BB%BA/&text=CTFd动态靶机搭建"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://itsbefore.github.io/archives/2022/08/30/CTFd%E9%9D%B6%E5%9C%BA%E6%90%AD%E5%BB%BA/&title=CTFd动态靶机搭建"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://itsbefore.github.io/archives/2022/08/30/CTFd%E9%9D%B6%E5%9C%BA%E6%90%AD%E5%BB%BA/&is_video=false&description=CTFd动态靶机搭建"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=CTFd动态靶机搭建&body=Check out this article: https://itsbefore.github.io/archives/2022/08/30/CTFd%E9%9D%B6%E5%9C%BA%E6%90%AD%E5%BB%BA/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://itsbefore.github.io/archives/2022/08/30/CTFd%E9%9D%B6%E5%9C%BA%E6%90%AD%E5%BB%BA/&title=CTFd动态靶机搭建"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://itsbefore.github.io/archives/2022/08/30/CTFd%E9%9D%B6%E5%9C%BA%E6%90%AD%E5%BB%BA/&title=CTFd动态靶机搭建"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://itsbefore.github.io/archives/2022/08/30/CTFd%E9%9D%B6%E5%9C%BA%E6%90%AD%E5%BB%BA/&title=CTFd动态靶机搭建"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://itsbefore.github.io/archives/2022/08/30/CTFd%E9%9D%B6%E5%9C%BA%E6%90%AD%E5%BB%BA/&title=CTFd动态靶机搭建"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://itsbefore.github.io/archives/2022/08/30/CTFd%E9%9D%B6%E5%9C%BA%E6%90%AD%E5%BB%BA/&name=CTFd动态靶机搭建&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://itsbefore.github.io/archives/2022/08/30/CTFd%E9%9D%B6%E5%9C%BA%E6%90%AD%E5%BB%BA/&t=CTFd动态靶机搭建"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text">基于docker搭建支持动态靶机的靶场</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-number">1.1.</span> <span class="toc-text">我的环境</span></a></li><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-number">1.2.</span> <span class="toc-text">系统环境搭建配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-number">1.3.</span> <span class="toc-text">靶场环境</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">2.</span> <span class="toc-text">Docker</span></a></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        CTFd动态靶机搭建
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">itsbefore</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2022-08-30T05:10:33.000Z" class="dt-published" itemprop="datePublished">2022-08-30</time>
        
      
    </div>

      
    <div class="article-category">
        <i class="fa-solid fa-archive"></i>
        <a class="category-link" href="/categories/%E5%85%B6%E4%BB%96/">其他</a>
    </div>


      

    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <h1><span id="基于docker搭建支持动态靶机的靶场">基于docker搭建支持动态靶机的靶场</span></h1><p>每做一道题，就会自动生成一个虚拟题目环境，每一个环境刚刚生成的时候都是崭新的。</p>
<h2><span id="我的环境">我的环境</span></h2><ul>
<li>主机：腾讯云的轻量服务器CentOS7.6-Docker20</li>
<li>Docker版本：20.10.17</li>
<li>Docker-compose版本：20.10.17</li>
<li>IP地址：公网地址</li>
</ul>
<p>然后就完全按照这个链接上的做🧎🧎🧎：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.yuque.com/docs/share/364ef08c-9405-45fe-b269-e9236de57242#OE1rs">https://www.yuque.com/docs/share/364ef08c-9405-45fe-b269-e9236de57242?#OE1rs</a></li>
</ul>
<p>成果：</p>
<p><img src="/images/ctfd.png" alt="ctfd"></p>
<h2><span id="系统环境搭建配置">系统环境搭建配置</span></h2><p>更新yum源，和安装系统环境所需服务：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">yum update
yum <span class="token function">install</span> -y <span class="token function">git</span> nginx mariadb mariadb-server Mysql-python python-pip gcc  python-devel yum-utils device-mapper-persistent-data lvm2 epel-release<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>因为我的vps自带了docker，就不安装了。</p>
<h2><span id="靶场环境">靶场环境</span></h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> ~
<span class="token function">git</span> clone https://github.com/glzjin/CTFd.git
<span class="token function">wget</span> https://github.com/fatedier/frp/releases/download/v0.29.0/frp_0.29.0_linux_amd64.tar.gz
<span class="token function">tar</span> -zxvf frp_0.29.0_linux_amd64.tar.gz
<span class="token function">git</span> clone https://github.com/glzjin/CTFd-Whale.git
<span class="token function">mv</span> CTFd-Whale/ ctfd-whale
<span class="token function">git</span> clone https://github.com/glzjin/Frp-Docker-For-CTFd-Whale
<span class="token function">mv</span> Frp-Docker-For-CTFd-Whale/ frp-docker-for-ctfd-whale
<span class="token function">docker</span> swarm init
<span class="token function">docker</span> <span class="token function">node</span> update --label-add<span class="token operator">=</span><span class="token string">'name=linux-1'</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">docker</span> <span class="token function">node</span> <span class="token function">ls</span> -q<span class="token variable">)</span></span>
<span class="token function">mv</span> ctfd-whale/ CTFd/CTFd/plugins/
<span class="token builtin class-name">cd</span> frp-docker-for-ctfd-whale
<span class="token function">docker-compose</span> up -d
<span class="token builtin class-name">cd</span> ~/CTFd
<span class="token function">mkdir</span> frpc
<span class="token builtin class-name">cd</span> ~/frp_0.29.0_linux_amd64
<span class="token function">mv</span> frpc.ini <span class="token punctuation">..</span>/CTFd/frpc/
<span class="token function">mv</span> frpc_full.ini <span class="token punctuation">..</span>/CTFd/frpc/
<span class="token function">mv</span> frpc <span class="token punctuation">..</span>/CTFd/frpc/
<span class="token function">mv</span> LICENSE <span class="token punctuation">..</span>/CTFd/frpc/
<span class="token builtin class-name">cd</span> ~/CTFd/frpc
<span class="token function">vim</span> frpc.ini<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>frpc.ini的内容修改如下：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>common<span class="token punctuation">]</span>
token <span class="token operator">=</span> randomme
server_addr <span class="token operator">=</span> <span class="token number">172.1</span>.0.4
server_port <span class="token operator">=</span> <span class="token number">6490</span>
pool_count <span class="token operator">=</span> <span class="token number">200</span>
tls_enable <span class="token operator">=</span> <span class="token boolean">true</span>

admin_addr <span class="token operator">=</span> <span class="token number">172.1</span>.0.3
admin_port <span class="token operator">=</span> <span class="token number">7400</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> ~/CTFd
<span class="token function">vim</span> Dockerfile<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>Dockerfile的内容如下：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">FROM python:3.6-alpine
RUN <span class="token function">sed</span> -i <span class="token string">'s/dl-cdn.alpinelinux.org/mirrors.aliyun.com/g'</span> /etc/apk/repositories <span class="token operator">&amp;&amp;</span><span class="token punctuation">\</span>
    apk update <span class="token operator">&amp;&amp;</span> <span class="token punctuation">\</span>
    apk <span class="token function">add</span> python3 python3-dev linux-headers libffi-dev gcc <span class="token function">make</span> musl-dev py-pip mysql-client <span class="token function">git</span> openssl-dev g++
RUN adduser -D -u <span class="token number">1001</span> -s /bin/bash ctfd
WORKDIR /opt/CTFd
RUN <span class="token function">mkdir</span> -p /opt/CTFd /var/log/CTFd /var/uploads
RUN pip3 config <span class="token builtin class-name">set</span> global.index-url https://pypi.doubanio.com/simple
RUN pip3 config <span class="token builtin class-name">set</span> install.trusted-host pypi.doubanio.com
COPY requirements.txt <span class="token builtin class-name">.</span>
RUN pip <span class="token function">install</span> -r requirements.txt -i  https://pypi.doubanio.com/simple
COPY <span class="token builtin class-name">.</span> /opt/CTFd
RUN <span class="token keyword">for</span> <span class="token for-or-select variable">d</span> <span class="token keyword">in</span> CTFd/plugins/*<span class="token punctuation">;</span> <span class="token keyword">do</span> <span class="token punctuation">\</span>
      <span class="token keyword">if</span> <span class="token punctuation">[</span> -f <span class="token string">"<span class="token variable">$d</span>/requirements.txt"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span> <span class="token punctuation">\</span>
        pip <span class="token function">install</span> -r <span class="token variable">$d</span>/requirements.txt -i  https://pypi.doubanio.com/simple<span class="token punctuation">;</span> <span class="token punctuation">\</span>
      <span class="token keyword">fi</span><span class="token punctuation">;</span> <span class="token punctuation">\</span>
    <span class="token keyword">done</span><span class="token punctuation">;</span>
RUN <span class="token function">chmod</span> +x /opt/CTFd/docker-entrypoint.sh
RUN <span class="token function">chown</span> -R <span class="token number">1001</span>:1001 /opt/CTFd
RUN <span class="token function">chown</span> -R <span class="token number">1001</span>:1001 /var/log/CTFd /var/uploads
<span class="token environment constant">USER</span> <span class="token number">1001</span>
EXPOSE <span class="token number">8000</span>
ENTRYPOINT <span class="token punctuation">[</span><span class="token string">"/opt/CTFd/docker-entrypoint.sh"</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">vim</span> docker-compose.yml<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>docker-compose.yml的内容如下：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">version: <span class="token string">'2.2'</span>

services:
  ctfd-nginx:
    image: nginx:1.17
    volumes:
      - ./nginx/http.conf:/etc/nginx/nginx.conf   
    user: root
    restart: always
    ports:    
      - <span class="token string">"443:443"</span>
    networks:
        default:
        internal:
    depends_on:
      - ctfd
    cpus: <span class="token string">'1.00'</span>  
    mem_limit: 150M     
  ctfd:
    build: <span class="token builtin class-name">.</span>
    user: root
    restart: always
    ports:
      - <span class="token string">"8000:8000"</span>     
    environment:
      - <span class="token assign-left variable">UPLOAD_FOLDER</span><span class="token operator">=</span>/var/uploads
      - <span class="token assign-left variable">DATABASE_URL</span><span class="token operator">=</span>mysql+pymysql://root:ctfd@db/ctfd
      - <span class="token assign-left variable">REDIS_URL</span><span class="token operator">=</span>redis://cache:6379
      - <span class="token assign-left variable">WORKERS</span><span class="token operator">=</span><span class="token number">1</span>
      - <span class="token assign-left variable">LOG_FOLDER</span><span class="token operator">=</span>/var/log/CTFd
      - <span class="token assign-left variable">ACCESS_LOG</span><span class="token operator">=</span>-
      - <span class="token assign-left variable">ERROR_LOG</span><span class="token operator">=</span>-
      - <span class="token assign-left variable">REVERSE_PROXY</span><span class="token operator">=</span>true
    volumes:
      - .data/CTFd/logs:/var/log/CTFd
      - .data/CTFd/uploads:/var/uploads
      - .:/opt/CTFd:ro
      - /var/run/docker.sock:/var/run/docker.sock     
    depends_on:
      - db
    networks:
        default:
        internal:
        frp:
            ipv4_address: <span class="token number">172.1</span>.0.2
    cpus: <span class="token string">'1.00'</span>     
    mem_limit: 450M     

  db:
    image: mariadb:10.4
    restart: always
    environment:
      - <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span>ctfd
      - <span class="token assign-left variable">MYSQL_USER</span><span class="token operator">=</span>ctfd
      - <span class="token assign-left variable">MYSQL_PASSWORD</span><span class="token operator">=</span>ctfd
    volumes:
      - .data/mysql:/var/lib/mysql
    networks:
        internal:
    command: <span class="token punctuation">[</span>mysqld, --character-set-server<span class="token operator">=</span>utf8mb4, --collation-server<span class="token operator">=</span>utf8mb4_unicode_ci, --wait_timeout<span class="token operator">=</span><span class="token number">28800</span>, --log-warnings<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">]</span>
    cpus: <span class="token string">'1.00'</span>     
    mem_limit: 750M     

  cache:
    image: redis:4
    restart: always
    volumes:
      - .data/redis:/data
    networks:
        internal:
    cpus: <span class="token string">'1.00'</span>     
    mem_limit: 450M     

  frpc:    
    image: glzjin/frp:latest     
    restart: always
    volumes:
      - ./frpc:/conf/     
    entrypoint:
        - /usr/local/bin/frpc
        - -c
        - /conf/frpc.ini
    networks:
        frp:
            ipv4_address: <span class="token number">172.1</span>.0.3  
        frp-containers:
    cpus: <span class="token string">'1.00'</span>     
    mem_limit: 250M     

networks:
    default:
    internal:
        internal: <span class="token boolean">true</span>
    frp:
        driver: bridge
        ipam:
            config:
                - subnet: <span class="token number">172.1</span>.0.0/16
    frp-containers:
        driver: overlay
        internal: <span class="token boolean">true</span>
        ipam:
            config:
                - subnet: <span class="token number">172.2</span>.0.0/16


<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">vim</span> requirements.txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>requirements.txt的内容如下：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token assign-left variable">Flask</span><span class="token operator">==</span><span class="token number">1.1</span>.1
<span class="token assign-left variable">Werkzeug</span><span class="token operator">==</span><span class="token number">0.16</span>.0
Flask-SQLAlchemy<span class="token operator">==</span><span class="token number">2.4</span>.1
Flask-Caching<span class="token operator">==</span><span class="token number">1.4</span>.0
Flask-Migrate<span class="token operator">==</span><span class="token number">2.5</span>.2
Flask-Script<span class="token operator">==</span><span class="token number">2.0</span>.6
<span class="token assign-left variable">SQLAlchemy</span><span class="token operator">==</span><span class="token number">1.3</span>.11
SQLAlchemy-Utils<span class="token operator">==</span><span class="token number">0.36</span>.0
<span class="token assign-left variable">passlib</span><span class="token operator">==</span><span class="token number">1.7</span>.2
<span class="token assign-left variable">bcrypt</span><span class="token operator">==</span><span class="token number">3.1</span>.7
<span class="token assign-left variable">six</span><span class="token operator">==</span><span class="token number">1.13</span>.0
<span class="token assign-left variable">itsdangerous</span><span class="token operator">==</span><span class="token number">1.1</span>.0
requests<span class="token operator">>=</span><span class="token number">2.20</span>.0
<span class="token assign-left variable">PyMySQL</span><span class="token operator">==</span><span class="token number">0.9</span>.3
<span class="token assign-left variable">gunicorn</span><span class="token operator">==</span><span class="token number">19.9</span>.0
<span class="token assign-left variable">normality</span><span class="token operator">==</span><span class="token number">2.0</span>.0
<span class="token assign-left variable">dataset</span><span class="token operator">==</span><span class="token number">1.1</span>.2
<span class="token assign-left variable">mistune</span><span class="token operator">==</span><span class="token number">0.8</span>.4
<span class="token assign-left variable">netaddr</span><span class="token operator">==</span><span class="token number">0.7</span>.19
<span class="token assign-left variable">redis</span><span class="token operator">==</span><span class="token number">3.3</span>.11
<span class="token assign-left variable">datafreeze</span><span class="token operator">==</span><span class="token number">0.1</span>.0
python-dotenv<span class="token operator">==</span><span class="token number">0.10</span>.3
flask-restplus<span class="token operator">==</span><span class="token number">0.13</span>.0
<span class="token assign-left variable">pathlib2</span><span class="token operator">==</span><span class="token number">2.3</span>.5
flask-marshmallow<span class="token operator">==</span><span class="token number">0.10</span>.1
marshmallow-sqlalchemy<span class="token operator">==</span><span class="token number">0.17</span>.0
<span class="token assign-left variable">boto3</span><span class="token operator">==</span><span class="token number">1.10</span>.39
<span class="token assign-left variable">marshmallow</span><span class="token operator">==</span><span class="token number">2.20</span>.2
<span class="token assign-left variable">gevent</span><span class="token operator">==</span><span class="token number">1.4</span>.0
<span class="token assign-left variable">tzlocal</span><span class="token operator">==</span><span class="token number">2.1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mkdir</span> nginx
<span class="token builtin class-name">cd</span> nginx
<span class="token function">vim</span> http.conf<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>http.conf的内容如下：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">worker_processes <span class="token number">4</span><span class="token punctuation">;</span>
events <span class="token punctuation">&#123;</span>
  worker_connections <span class="token number">1024</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
http <span class="token punctuation">&#123;</span>
  <span class="token comment"># Configuration containing list of application servers</span>
  upstream app_servers <span class="token punctuation">&#123;</span>
    server ctfd:8000<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  server <span class="token punctuation">&#123;</span>
    listen <span class="token number">80</span><span class="token punctuation">;</span>
    client_max_body_size 4G<span class="token punctuation">;</span>
    <span class="token comment"># Handle Server Sent Events for Notifications</span>
    location /events <span class="token punctuation">&#123;</span>
      proxy_pass http://app_servers<span class="token punctuation">;</span>
      proxy_set_header Connection <span class="token string">''</span><span class="token punctuation">;</span>
      proxy_http_version <span class="token number">1.1</span><span class="token punctuation">;</span>
      chunked_transfer_encoding off<span class="token punctuation">;</span>
      proxy_buffering off<span class="token punctuation">;</span>
      proxy_cache off<span class="token punctuation">;</span>
      proxy_redirect off<span class="token punctuation">;</span>
      proxy_set_header Host <span class="token variable">$host</span><span class="token punctuation">;</span>
      proxy_set_header X-Real-IP <span class="token variable">$remote_addr</span><span class="token punctuation">;</span>
      proxy_set_header X-Forwarded-For <span class="token variable">$proxy_add_x_forwarded_for</span><span class="token punctuation">;</span>
      proxy_set_header X-Forwarded-Host <span class="token variable">$server_name</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment"># Proxy connections to the application servers</span>
    location / <span class="token punctuation">&#123;</span>
      proxy_pass http://app_servers<span class="token punctuation">;</span>
      proxy_redirect off<span class="token punctuation">;</span>
      proxy_set_header Host <span class="token variable">$host</span><span class="token punctuation">;</span>
      proxy_set_header X-Real-IP <span class="token variable">$remote_addr</span><span class="token punctuation">;</span>
      proxy_set_header X-Forwarded-For <span class="token variable">$proxy_add_x_forwarded_for</span><span class="token punctuation">;</span>
      proxy_set_header X-Forwarded-Host <span class="token variable">$server_name</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> ~/CTFd
<span class="token function">docker-compose</span> up -d
<span class="token function">docker</span> network connect --ip <span class="token number">172.1</span>.0.3 ctfd_frp ctfd_frpc_1
<span class="token function">docker</span> network connect --ip <span class="token number">172.1</span>.0.4 ctfd_frp frp-docker-for-ctfd-whale_frps_1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>最后</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> <span class="token function">ps</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>查看容器，应该有6个容器，且查看状态STATUS是否是UP。是UP就OK。</p>
<p>在浏览器访问：<a target="_blank" rel="noopener" href="http://ip:8000/">http://ip:8000</a> 即可打开。</p>
<h1><span id="docker">Docker</span></h1><p>我尝试了自己写web题目，这就要用到docker的知识。docker里有2个很重要的概念：容器和镜像。容器和镜像类似于对象和类。每道题目实际上是实例化或销毁一个docker镜像。</p>
<p>在 <a target="_blank" rel="noopener" href="https://www.yuque.com/docs/share/364ef08c-9405-45fe-b269-e9236de57242#OE1rs">https://www.yuque.com/docs/share/364ef08c-9405-45fe-b269-e9236de57242?#OE1rs</a> 里发放web题目时有一个<code>Docker Images</code>填写的是ctftraining&#x2F;qwb_2019_supersqil。docker images就是镜像，我们填写的镜像名字是ctftraining&#x2F;qwb_2019_supersqil，但是我们本地没有这个镜像啊，怎么还是创建成功了呢？是因为：</p>
<blockquote>
<p>当运行容器时，使用的镜像如果在本地中不存在，docker 就会自动从 docker 镜像仓库中下载，默认是从 Docker Hub 公共镜像源下载。</p>
</blockquote>
<p>我们可以从Docker Hub网站上查找镜像：<a target="_blank" rel="noopener" href="https://hub.docker.com/">Docker Hub Container Image Library | App Containerization</a> </p>
<p>那如何自己出题目，自己创建镜像捏。我查阅了菜鸟教程上docker的知识，懂了大概。</p>
<p>可以利用本地有的镜像，实例化成容器后，使用<code>docker exec -it id /bin/sh</code>命令进入容器，进行web环境的搭建。搭建好后exit退出容器。再使用<code>docker commit id image</code>从已经创建的容器中更新镜像，并且提交这个镜像。最后在发放web题目时docker images填写我们生成的image名字就行了。</p>
<p><em>一些常用命令：</em></p>
<p><strong>容器：</strong></p>
<table>
<thead>
<tr>
<th>命令</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>docker ps -a</td>
<td>列出所有docker进程，可以查看id、状态……</td>
</tr>
<tr>
<td>docker stop id</td>
<td>关闭指定id的docker进程</td>
</tr>
<tr>
<td>docker start id</td>
<td>开启指定id的docker进程</td>
</tr>
<tr>
<td>docker rm -f id</td>
<td>删除指定id的docker容器</td>
</tr>
<tr>
<td>docker exec -it id &#x2F;bin&#x2F;sh</td>
<td>进入指定id的docker容器</td>
</tr>
<tr>
<td>docker commit id image</td>
<td>从已经创建的容器中更新镜像，并且提交这个镜像</td>
</tr>
</tbody></table>
<p><strong>镜像：</strong></p>
<table>
<thead>
<tr>
<th>命令</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>docker images</td>
<td>查看所有镜像</td>
</tr>
<tr>
<td>docker run -it name &#x2F;bin&#x2F;sh</td>
<td>实例化镜像</td>
</tr>
<tr>
<td>docker rmi name</td>
<td>删除镜像</td>
</tr>
</tbody></table>
<hr>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">首页</a></li>
        
          <li><a href="/archives/">归档</a></li>
        
          <li><a href="/categories/">分类</a></li>
        
          <li><a href="/about/">关于</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text">基于docker搭建支持动态靶机的靶场</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-number">1.1.</span> <span class="toc-text">我的环境</span></a></li><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-number">1.2.</span> <span class="toc-text">系统环境搭建配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-number">1.3.</span> <span class="toc-text">靶场环境</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">2.</span> <span class="toc-text">Docker</span></a></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://itsbefore.github.io/archives/2022/08/30/CTFd%E9%9D%B6%E5%9C%BA%E6%90%AD%E5%BB%BA/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://itsbefore.github.io/archives/2022/08/30/CTFd%E9%9D%B6%E5%9C%BA%E6%90%AD%E5%BB%BA/&text=CTFd动态靶机搭建"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://itsbefore.github.io/archives/2022/08/30/CTFd%E9%9D%B6%E5%9C%BA%E6%90%AD%E5%BB%BA/&title=CTFd动态靶机搭建"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://itsbefore.github.io/archives/2022/08/30/CTFd%E9%9D%B6%E5%9C%BA%E6%90%AD%E5%BB%BA/&is_video=false&description=CTFd动态靶机搭建"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=CTFd动态靶机搭建&body=Check out this article: https://itsbefore.github.io/archives/2022/08/30/CTFd%E9%9D%B6%E5%9C%BA%E6%90%AD%E5%BB%BA/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://itsbefore.github.io/archives/2022/08/30/CTFd%E9%9D%B6%E5%9C%BA%E6%90%AD%E5%BB%BA/&title=CTFd动态靶机搭建"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://itsbefore.github.io/archives/2022/08/30/CTFd%E9%9D%B6%E5%9C%BA%E6%90%AD%E5%BB%BA/&title=CTFd动态靶机搭建"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://itsbefore.github.io/archives/2022/08/30/CTFd%E9%9D%B6%E5%9C%BA%E6%90%AD%E5%BB%BA/&title=CTFd动态靶机搭建"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://itsbefore.github.io/archives/2022/08/30/CTFd%E9%9D%B6%E5%9C%BA%E6%90%AD%E5%BB%BA/&title=CTFd动态靶机搭建"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://itsbefore.github.io/archives/2022/08/30/CTFd%E9%9D%B6%E5%9C%BA%E6%90%AD%E5%BB%BA/&name=CTFd动态靶机搭建&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://itsbefore.github.io/archives/2022/08/30/CTFd%E9%9D%B6%E5%9C%BA%E6%90%AD%E5%BB%BA/&t=CTFd动态靶机搭建"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> 菜单</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> 目录</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> 分享</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> 返回顶部</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2021-2025
    itsbefore
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">首页</a></li><!--
     --><!--
       --><li><a href="/archives/">归档</a></li><!--
     --><!--
       --><li><a href="/categories/">分类</a></li><!--
     --><!--
       --><li><a href="/about/">关于</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"复制到粘贴板！\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "复制成功！");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
